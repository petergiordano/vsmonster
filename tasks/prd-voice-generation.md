# Product Requirements Document: Voice Generation (Step 2 of 8-Component Pipeline)

## Introduction/Overview

The Voice Generation component is **Step 2** of the versusMonster Automated Video Podcast System's 8-component iterative build strategy. Following the PRD-v0 "Function Over Fashion" philosophy, this component transforms structured JSON dialogue data into individual character voice files using ElevenLabs API integration.

**Iterative Build Context**: As Step 2, Voice Generation consumes the JSON output from Step 1 (Script Parser) and produces voice files that enable Step 3 (Audio Assembly). This component proves ElevenLabs integration works and validates character voice distinctiveness.

**Problem Statement**: Script Parser JSON contains dialogue text but no audio. Manual voice recording would eliminate automation benefits and require professional voice actors for consistent character portrayal across 104 episodes.

**Solution**: A reliable command-line voice generator that processes Script Parser JSON, applies character-specific voice settings via ElevenLabs API, and produces individual WAV files ready for audio assembly.

## Goals

**Primary Goal (PRD-v0 Alignment)**: JSON → individual voice files to enable Step 3 (Audio Assembly)

### Specific Success Criteria
1. **Foundation Goal**: Generate authentic Thorak and Zara voices (validates PRD-v0 Step 2)
2. **Quality Goal**: Process Episode 7 with 100% dialogue coverage (69 voice files)
3. **Compound Value Goal**: Voice files serve as foundation for Steps 3-8 without modification
4. **Simplicity Goal**: Single command operation (`python voice_gen.py episode_007.json`)
5. **Character Goal**: Thorak sounds scholarly, Zara sounds energetic and distinct
6. **Independence Goal**: Functions completely independently - Step 3 doesn't break if Steps 4-8 aren't built yet

## User Stories

### Primary Users: 8-Component Pipeline (PRD-v0 Iterative Strategy)

**As Step 3 (Audio Assembly)**, I want individual voice files with consistent naming and timing so that I can combine voices with proper synchronization without any file transformation.

**As Steps 4-8 (Video Pipeline)**, I want voice files generated by Step 2 so that each subsequent step has the audio foundation needed for compound value building.

**As the overall 8-component system**, I want Step 2 to work independently so that I can test and validate voice generation in isolation before building Steps 3-8.

### Secondary Users: Content Creators & System Operators

**As a podcast creator**, I want character voice consistency across episodes so that Thorak and Zara maintain their distinct personalities throughout the series.

**As a system operator**, I want accurate cost tracking so that I can monitor ElevenLabs API usage and budget compliance.

**As a script generator AI**, I want voice direction feedback so that I can optimize dialogue for character voice capabilities.

## Functional Requirements

### Core Voice Generation Requirements

1. **JSON Input Processing**: The voice generator must accept Script Parser JSON files and validate dialogue structure before processing.

2. **Character Voice Mapping**: The voice generator must map characters to specific ElevenLabs voice IDs:
   - THORAK: Scholarly, gravelly tone (Stability 0.75, Similarity 0.85)
   - ZARA: Energetic, emotional variation (Stability 0.45, Similarity 0.75)
   - BOTH: Use primary character voice based on context

3. **Voice Direction Integration**: The voice generator must apply voice directions to ElevenLabs parameters:
   - Parse direction text (e.g., "Breathless", "Gravelly, impressed")
   - Adjust voice stability and similarity based on emotional context
   - Handle null directions with character default settings

4. **Dialogue Processing**: The voice generator must process all dialogue entries with:
   - Character attribution validation
   - Text preprocessing for voice generation
   - Character count tracking for cost validation
   - Line position preservation for debugging

5. **ElevenLabs API Integration**: The voice generator must interface with ElevenLabs API:
   - Use official Python SDK (`elevenlabs` package)
   - Implement Eleven Multilingual v2 model for highest quality
   - Handle API rate limiting and error responses
   - Support streaming for real-time processing

6. **File Output Management**: The voice generator must create organized voice files:
   - WAV format at 44.1kHz sample rate
   - Filename pattern: `{episode}_{scene_id}_{dialogue_index}_{character}.wav`
   - Directory structure: `output/voices/{episode_name}/`
   - Consistent file permissions and encoding

### Quality Assurance Requirements

7. **Cost Tracking Integration**: The voice generator must monitor API usage:
   - Real-time character count tracking
   - Cost calculation using Script Parser estimates
   - Comparison against predicted costs ($3.06 for Episode 7)
   - Cost reporting in validation files

8. **Progress Reporting**: The voice generator must provide clear status updates:
   - 5-step progress display (following Script Parser pattern)
   - Scene-by-scene processing updates
   - Character count and file generation progress
   - Error reporting with actionable guidance

9. **Error Recovery**: The voice generator must handle failures gracefully:
   - API connection failures
   - Rate limiting responses
   - Invalid JSON input
   - Malformed dialogue entries
   - Always produce partial results when possible

10. **Validation Reporting**: The voice generator must create comprehensive reports:
    - Voice generation summary as `{episode}_voice_report.txt`
    - API usage statistics and cost breakdown
    - Missing or failed dialogue entries
    - Voice quality metadata

### Performance Requirements

11. **Processing Efficiency**: The voice generator must complete Episode 7 processing (69 dialogues) in under 5 minutes with standard internet connection.

12. **API Rate Compliance**: The voice generator must respect ElevenLabs rate limits and implement appropriate delays between requests.

13. **Memory Management**: The voice generator must handle audio data efficiently without memory leaks during batch processing.

14. **Resume Capability**: The voice generator must skip already-generated files to support interrupted processing recovery.

## Technical Requirements

### ElevenLabs Integration Specifications

15. **SDK Configuration**: Use official ElevenLabs Python SDK with environment variable API key management.

16. **Voice Model Settings**:
    - Model: `eleven_multilingual_v2`
    - Output Format: `wav_44100`
    - Quality: Highest available

17. **Character Voice Configuration**:
    ```json
    {
      "THORAK": {
        "voice_id": "TBD_SCHOLARLY_VOICE",
        "stability": 0.75,
        "similarity": 0.85,
        "style": 0.2
      },
      "ZARA": {
        "voice_id": "TBD_ENERGETIC_VOICE", 
        "stability": 0.45,
        "similarity": 0.75,
        "style": 0.6
      }
    }
    ```

18. **API Key Security**: Load API key from `.env` file using `python-dotenv` with secure error handling.

### Output Format Requirements

19. **File Organization**:
    ```
    output/voices/episode_007/
    ├── episode_007_cold_open_001_ZARA.wav
    ├── episode_007_cold_open_002_THORAK.wav
    ├── episode_007_cold_open_003_ZARA.wav
    └── episode_007_cold_open_004_THORAK.wav
    ```

20. **Metadata Preservation**: Each voice file must include metadata:
    - Original dialogue text
    - Character and voice direction
    - Generation timestamp
    - ElevenLabs model and settings used

## Non-Goals (Out of Scope)

- **Real-time Voice Generation**: Will not support live/streaming voice generation initially
- **Custom Voice Training**: Will use pre-existing ElevenLabs voices, not custom trained models
- **Multi-language Support**: Initial implementation English-only (Episode 7 format)
- **Voice Effects Processing**: Basic voice generation only, no reverb/echo/filters
- **Background Music Integration**: Pure voice generation, audio mixing handled by Step 3

## Success Metrics

### Functional Success Criteria
- ✅ All 69 Episode 7 dialogues converted to voice files
- ✅ Thorak and Zara voices sound distinct and character-appropriate
- ✅ Processing completes without manual intervention
- ✅ Output files ready for Audio Assembly consumption

### Technical Success Criteria  
- ✅ Command execution: `python voice_gen.py episode_007.json`
- ✅ Processing time under 5 minutes for Episode 7
- ✅ API cost within 5% of Script Parser estimates
- ✅ Zero failed dialogue generations

### Integration Success Criteria
- ✅ Seamless handoff from Script Parser JSON
- ✅ Voice files compatible with Audio Assembly requirements
- ✅ Error handling maintains pipeline integrity
- ✅ Cost tracking enables budget monitoring

## Dependencies

### Technical Dependencies
- **Script Parser JSON**: Requires completed Step 1 output
- **ElevenLabs API**: Valid API key and internet connection
- **Python Environment**: Python 3.11+ with `elevenlabs` SDK
- **Output Directory**: `output/voices/` structure must exist

### Business Dependencies
- **ElevenLabs Account**: Active subscription with sufficient character quota
- **Voice Selection**: Approved voice IDs for Thorak and Zara characters
- **Cost Budget**: Allocated budget for Episode 7 testing (~$3.06)

## Risk Assessment

### Technical Risks
- **API Rate Limiting**: ElevenLabs may throttle requests during bulk processing
- **Network Failures**: Internet connectivity issues during voice generation
- **Voice Quality**: Generated voices may not match character personality expectations

### Mitigation Strategies
- **Retry Logic**: Implement exponential backoff for API failures
- **Progress Checkpointing**: Save progress to enable resume after interruptions
- **Voice Testing**: Validate character voices with sample text before Episode 7 processing

## Validation Strategy

### Episode 7 Validation
1. **Input Validation**: Load and validate `output/json/episode_007.json`
2. **Character Mapping**: Verify all THORAK/ZARA dialogues map to voice IDs
3. **Voice Generation**: Process all 69 dialogues successfully
4. **Quality Check**: Manual review of sample voice files for character authenticity
5. **Cost Verification**: Compare actual API usage against Script Parser estimates

### Integration Validation
1. **Pipeline Test**: `python parser.py episode_007.md && python voice_gen.py episode_007.json`
2. **File Structure**: Verify output files follow naming convention
3. **Metadata Accuracy**: Check voice files contain correct dialogue content
4. **Error Scenarios**: Test with malformed JSON and missing API key

This PRD establishes Voice Generation as a robust, independent component that successfully bridges Script Parser output with Audio Assembly requirements while maintaining the PRD-v0 principles of simplicity, reliability, and compound value creation.